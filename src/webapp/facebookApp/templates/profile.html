{% extends "base.html" %}
{% load i18n %}
{% load humanize %}
{% load tags %}

{% block title %}Perfil público de {{profile.username}}{% endblock %}
{% block extra_js %}
    <script src="/static/webapp/js/jquery.tmpl.min.js"></script>
    <script src="/static/facebookApp/js/grm.js"></script>
    <script src="/static/facebookApp/js/social.js"></script>
    <script src="/static/facebookApp/js/chronology.js"></script>

    
    <script type="text/javascript">
    
    $("#user-avatar").ready(function(){
        $(this).load();
    });
    $(document).ready(function(){
        
        //Adding behaviour to tab content
        $('#tabMenu li').click(function(){
            tab_id=$('#tabMenu li.active').attr('id')
            $('#'+tab_id+'_content').addClass('hidden');
            $('#tabMenu li.active').removeClass('active');
            
            tab_id=$(this).attr('id')
            $('#'+tab_id+'_content').removeClass('hidden');
            $(this).addClass('active');
        })
    });
    </script>
{%endblock%}

{% block body %}
    <div id="public-profile">
<!--
        <div id="col-right-left">
-->
            <div id="avatar-follow">
                <a href="/user/{{profile.username}}/picture/"><img id="user-avatar" src="/user/{{profile.username}}/picture/" alt="{{profile.username}} avatar"/></a>
                <br>
                {% ifnotequal user.username profile.parent.username %}
                    {% if is_follower %}
                        <div id="following_state_{{ profile.parent.id }}" class="follow-button following-state">
                            <span  onclick="javascript:follow('unfollow',{{profile.parent.id}})"><a href="#" class="following">Seguiendo</a></span>
                        </div>
                    {% else %}
                        <div id="following_state_{{ profile.parent.id }}" class="follow-button">
                            <span  onclick="javascript:follow('follow',{{profile.parent.id}})"><a href="#" class="no-following">Seguir</a></span>
                        </div>
                    {% endif %}
                {% else %}
                    
                    <span class="btn"><a href="{% url fb_edit_profile %}" id="edit-profile-btn">Editar</a> </span>
                    
                {% endifnotequal %}
            </div>
            
            <div id="user-info">
                <h1>{{profile.parent.username}}</h1>
                
            
        
            
            
<!--
        </div>
-->
<!--
        <div id="col-right-right">
-->
            <ul id="user-resume">
                <li><a href=""><span id="counter">{{counters.influenced}}</span> impactos</a></li>
                <li><a href="{% url fb_followers_panel profile.parent.username %}"><span id="counter">{{counters.followers}}</span> seguidores</a></li>
                <li><a href="{% url fb_followings_panel profile.parent.username %}"><span id="counter">{{counters.followings}}</span> siguiendo</a></li>
            </ul>
            {% if profile.description %}
                    <p>{{profile.description}}</p>
                {% endif %}
            <p>
                <span>También está en:</span><br>
                <ul id="social-networks">
                    {% if profile.sociallinks.facebook %}
                        <li><a href="{{profile.sociallinks.facebook}}" id="facebook-icon">Facebook</a></li>
                    {% endif %}
                    {% if profile.sociallinks.twitter %}
                        <li><a href="{{profile.sociallinks.twitter}}"  id="twitter-icon">Twitter</a></li>
                    {% endif %}
                    {% if profile.sociallinks.foursquare %}
                        <li><a href="{{profile.sociallinks.foursquare}}" id="foursquare-icon">Foursquare</a></li>
                {% endif %}
                </ul>
            </p>
        </div>
<!--
        </div>
-->
    </div>
    <ul id="tabMenu" class="clear">
		<li id="his_activity" class="active">Actividad</li>
        <li id="his_suggestions">Sugerencias ({{counters.suggested}})</li>
		<li id="his_votes">Valoraciones ({{counters.supported}})</li>
		<li id="his_lists">Listas</li>
	</ul>
    <div id="content">
            
            <!-- HIS TIMELINE -->
            <span id="his_activity_content" class="tab-content ">
                {% if chronology.1|length %}    
                <!--
                        <p>{{chronology.1.0}} mensajes</p>
                -->
                    <ul id="chronology">
                    {% for obj in chronology.1 %}

                        {% if not obj.msg_id = 100 or not obj.is_private %}
                            <li {% if forloop.last %} style="border:0" {% endif %}>
                                {% timeline_item obj %}
                            </li>
                        {% endif %}

                    {% endfor %}
                    </ul>
                
                    <!-- Si hay más mensajes -->
                    {% if chronology.1|length == 15%}
                        <div class="load-more">Cargar más</div>
                    {% endif %}    
                    
                    
                {% endif %} 
            </span>
            <!-- END ALL SUGGESTIONS -->
            
            <!-- ALL SUGGESTIONS -->
            <span id="his_suggestions_content" class="tab-content hidden">
                <ul>
                    {% if suggestions.1|length = 0 %}
                        <li><p>Este usuario aún no ha hecho ninguna sugerencia</p></li>
                    {% else %}
                        {% for obj in suggestions.1 %}                        
                            <li {% if forloop.last %} style="border:0" {% endif %}>
                                <div class="avatar">
                                    <a href="{% url fb_public_profile obj.user.username %}" title="{{obj.user.username}}">
                                        <img src="/user/{{obj.user.username}}/picture/" alt="{{obj.user.username}} avatar"/>
                                    </a>
                                </div>
                                <div class="timeline-msg">
                                    <a href="">{{obj}}</a><br>
                                
                                    <span class="small-text">En <a href="/fb/place/{{obj.poi.slug}}">{{obj.poi.name}}</a></span><br>
                                    <span class="timestamp"> hace {{obj.created|timesince}}</span>  
                                    <span class="action-bar">
                                        {% if request.user != obj.user.username %}
                                            |
                                            <span class="like-dislike" value="{{obj.instance.id}}" {% if obj.has_voted %}like="true"{%endif%} type="suggestion">
                                                <span class="dislike">
                                                    <span class="hoverlink">Ya no me gusta</span> 
                                                    <span class="text like-text {% if not obj.has_voted %}increase{% endif %}">{{obj.vote_counter}}</span> personas
                                                </span>
                                                
                                                <span class="like">
                                                    Me gusta
                                                </span>
                                            </span>
                                        {% endif %}
                                    </span>
                                
                                </div>
                            </li>
                        {% endfor %}
                    {% endif %}
                </ul>
            </span>
            <!-- END ALL SUGGESTIONS -->
            
            <!-- ALL SUGGESTIONS -->
            <span id="his_votes_content" class="tab-content hidden">
                <p>Sus valoraciones</p>
            </span>
            <!-- END ALL SUGGESTIONS -->
            
            <!-- ALL SUGGESTIONS -->
            <span id="his_lists_content" class="tab-content hidden">
                <p>Sus listas</p>
            </span>
            <!-- END ALL SUGGESTIONS -->
    </div>
    
    <script id="suggestionTemplate" type="text/x-jquery-tmpl">
        <div id="suggestion_${element.id}" class="suggestion">
            <span class="suggestionName">${element.name}</span>
            <span class="suggestionInLists">Lista ${element.id}</span>
        </div>
    </script>
{% endblock %}
