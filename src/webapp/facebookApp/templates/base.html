{% load tags %}
{% load i18n %}

{% url fb_dashboard as dashboard %}
{% url fb_notifications as notifications_section %}
{% url fb_profile_settings as profile_settings %}
{% url fb_user_suggestions as user_suggestions %}
{% url fb_public_profile request.user.username as public_profile %}


<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml">
{% get_current_language as LANGUAGE_CODE %}
<html lang="{{LANGUAGE_CODE}}">
    {% block redirect %}{% endblock %}
    <meta charset="utf-8">
    <title>
      {% block title %}Welcome{% endblock %} &mdash; GeoRemindMe
    </title>
    <meta name="description" content="">
    <!--
        <link type="text/css" rel="stylesheet" href="/static/facebookApp/css/jquery-ui/jquery-ui-1.8.16.custom.css">
    -->

    {% if request.META.REMOTE_ADDR = "127.0.0.1" %}
        <link type="text/css" rel="stylesheet" href="/static/facebookApp/css/main.css">
        <script type="text/javascript" src="https://connect.facebook.net/en_US/all.js"></script>
        <script type="text/javascript" src="/static/common/js/common_facebookApp.js"></script>    
    {% else %}
        <link type="text/css" rel="stylesheet" href="/static/common/css/fb_style.min.css">
        <script type="text/javascript" src="https://connect.facebook.net/en_US/all.js"></script>
        <script type="text/javascript" src="/static/common/js/common_facebookApp.min.js"></script>    
    {% endif %}
    <script type="text/javascript" src="/static/common/js/raw/jquery.cookies.2.2.0.min.js"></script>        
<!--
    <script type="text/javascript" src="/static/facebookApp/js/main.js"></script>    
-->


    <script type="text/javascript">
        {% include "urls.html" %}
        

        $(document).ready(function(){
            resizeIframe();
            $("#right-col").resize(function(){resizeIframe();});
        });
    </script>
    {% block extra_js %}{%endblock%}
   
</head>
<body id="facebookApp">
    <div id="wait-mask" style="display:none"></div>
    <div id="container">


        <div id="left-col">
            <a id="logo" href="{{dashboard}}"><img src="/static/facebookApp/img/header_logo.png" alt="GeoRemindMe logo"></a>
        
            {% block mainButton %} 
                <a href="{% url fb_add_suggestion %}" id="btn-add-suggestion">Añadir sugerencia</a>
            {% endblock %}
            
            <hr>
            
        
            {% block nav %} 
                <ul>
                    <li class="menu-icons main-menu-icons" id="{% active request dashboard %}"><a id="activity-icon" href="{{dashboard}}" title="Dashboard">Actividad</a></li>
                    <li class="menu-icons main-menu-icons" id="{% active request user_suggestions %}"><a id="vault-icon" href="{{user_suggestions}}">Tu mochila</a></li>
<!--
                    <li class="menu-icons main-menu-icons"><a id="suggestions-icon" href="{{user_suggestions}}">Tus sugerencias</a></li>
-->
                    <li class="menu-icons main-menu-icons" id="{% active request notifications_section %}"><a id="notifications-icon" href="{{notifications_section}}">{% if notifications > 0 %}<strong>Notificaciones</strong>{% else %} Notificaciones {% endif %}</a></li>
<!--
                    <li class="menu-icons main-menu-icons"><a id="places-icon" href="#">Sitios</a></li>
-->
                    <li class="menu-icons main-menu-icons" id="{% active request public_profile %}"><a id="profile-icon" href="{{public_profile}}">Mi perfil ({{user.username}})</a></li>
                    <li class="menu-icons main-menu-icons" id="{% active request profile_settings %}"><a id="settings-icon" href="{{profile_settings}}">Configuración</a></li>
                </ul>
            {% block extraContent %} {% endblock %}
            {% endblock %}
            <hr>
            <p><strong>Facebook</strong>:</p>
            <ul>
                <li class="menu-icons fb-icons"><a id="fb-grm" href="http://www.facebook.com/GeoRemindMe" onclick="parent.location.href='http://www.facebook.com/GeoRemindMe'">Página de fans</a></li>
                {% if user.is_authenticated %}
                    <li class="menu-icons fb-icons"><a id="fb-last-news" href="http://www.facebook.com/?sk=nf" onclick="parent.location.href='http://www.facebook.com/?sk=nf'">Últimas noticias</a></li>
                    <li class="menu-icons fb-icons"><a id="fb-wall" href="{{user.facebook_user.profile_url}}&sk=wall" onclick="parent.location.href='{{user.facebook_user.profile_url}}&sk=wall'">Muro</a></li>
                    <li class="menu-icons fb-icons"><a id="fb-events" href="http://www.facebook.com/?sk=events&ap=1" onclick="parent.location.href='http://www.facebook.com/?sk=events&ap=1'">Eventos</a></li>
                {% endif %}
            </ul>
        </div>
        <div id="notification-msg" style="display:none">Mensaje con lo que sea</div>
        <div id="right-col">
<!--
            {% block goBack %}<p id="go-back" onclick="javascript:history.back()">Volver atrás</p>{% endblock %}
-->
            {% block body %}{% endblock %}
        </div>


    </div>
    
    <div id="fb-root"></div>
    <div id="templates"></div>



    <script type="text/javascript">
        {% if request.META.REMOTE_ADDR = "127.0.0.1" %}
            DEBUG_mode=true;
        {% else %}
            DEBUG_mode=false;
        {% endif %}
        
        
        
        permissions="{{permissions}}";     
        {% if request.user.facebook_user.uid %}
            user_uid={{request.user.facebook_user.uid}};
        {% endif %}

        <!-- async loading of facebook js sdk  -->
        $(document).ready(function(){ 
            
            window.fbAsyncInit = function() {
                facebookInit({
                    appId: '{{app_settings.appId}}', 
                    status : true, // check login status
                    cookie : true, // enable cookies to allow the server to access the session
                    xfbml  : true,  // parse XFBML
                    canvasName  : '{{app_settings.canvasName}}',
                    oauth  : true,
                    
                    {%if request.user.facebook_user.uid %} userIdOnServer  : {{request.user.facebook_user.uid}} {%endif%}
                });
                               
                {% block callBackFBInit %}{% endblock %}
            }
            
            
            
            
            $("#right-col").resize(function(){
                resizeIframe();
            });
        });
        
        (function() {
            var e = document.createElement('script');
            e.src = document.location.protocol + '//connect.facebook.net/en_US/all.js';
            e.async = true;
            document.getElementById('fb-root').appendChild(e);
        }());
        (function() {
            var e = document.createElement('script');
            e.src = "/static/facebookApp/js/main.js";
            document.getElementById('fb-root').appendChild(e);
        }());
        <!--  async loading of google analytics -->
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-19272923-3']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script');
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
</body>
</html>
