{% extends "base.html" %}
{% load i18n %}
{% load tags %}


{% block extra_js %}
		<script src="/static/webapp/js/jquery.tmpl.min.js"></script>
		<script src="/static/facebookApp/js/grm.js"></script>
		
        <script type="text/javascript">
        $(document).ready(function(){
			GRM.init();
			
            //Set like & dislike behaviour
            //$(".like-dislike").like();
            
            //Set like&dislike style
            $('#suggestion-list li,#comment-list li').hover(
                function(){$(this).find('.action-bar').show()},
                function(){$(this).find('.action-bar').hide()}
            )
            
            
			$('#list-description').html($('#list-description').html().replace(/none/ig, "<em>Sin descripción</em>"))
        });
	</script>
{%endblock%}

{% block title %}View list{% endblock %}

{% block goBack %}{%endblock%}    
{% block body %}
    <div id="view-list">
    	
    
    <h1>{{list}}</h1>
	<div id="suggestion-info">
		<p>Descripción: <span id="list-description">{{list.description}}</span></p>
	    <p>Autor: <a href="{% url fb_public_profile list.user %}">{{list.user}}</a></p>
	    <p>Etiquetas: <a href="#">Ocio</a> | <a href="#">Vacaciones</a> | <a href="#">Málaga</a></p>
	</div>
	<div id="suggestion-aside">
        
        Seguidores:
        <span id="counter">{{list.counters.followers}}</span>
        {% if list.user.username != request.user.username %}
            <span title="Guardar en favoritos"  class="remember-forget hoverlink" value="{{list.id}}" type="list" {%if user_follower%}remember="true"{%endif%}>
                <span class="remember">Guardar</span>
                <span class="forget">Guardada</span>
            </span>
        {% endif %}
        
    </div>
	
    <p class="clear-left big suggestions-title"><strong>Sugerencias ({{suggestions|length}})</strong></p>
	
	<ul id="suggestion-list">
		{% for obj in suggestions %}
		<li>           
                
                <span class="user"><a href="{% url fb_public_profile obj.instance.user.username %}"><img src="/user/{{obj.instance.user.username}}/picture/" alt="{{obj.instance.user.username}} avatar"></a></span>
                <div class="timeline-msg">

                    <span class="msg"><a href="{% url fb_view_suggestion obj.instance.slug %}" class="hoverlink">{{obj.instance.name}}</a></span>
                    {% if obj.instance.poi.slug %}
                        <span class="suggestionPlace">En <a href="{% url fb_view_place obj.instance.poi.slug %}" class="black-link">{{obj.instance.poi.name}}</a></span>
<!--
                        <br>
-->
                    {% endif %}
<!--
                    <span class="timestamp">{{obj.instance.created|naturaltime}} </span> 
-->
                    <span class="action-bar" style="display:none">

                        {% if not obj.is_private and obj.instance.user.username != request.user.username %}
                            &nbsp;- 
                            <span class="like-dislike hoverlink" value="{{obj.instance.id}}" {% if obj.has_voted %}like="true"{%endif%} type="suggestion">
                                <span class="dislike hoverlink">
                                    <span>Ya no me gusta</span> 
<!--
                                    <span class="text like-text increase">{{obj.vote_counter}}</span> personas
-->
                                </span>
                                
                                <span class="like">
                                    Me gusta
                                </span>
                            </span>
                            
                            | <span title="Recibe novedades"  class="remember-forget hoverlink" value="{{obj.instance.id}}" {%if obj.user_follower%}remember="true"{%endif%}><span class="remember">Guardar</span><span class="forget">Guardada</span></span>
                        {% endif %}
                    </span>
                        
                </div>
			
		</li>
		{% endfor %}
	</ul>
	
	{% if top_comments %}
		<h2>Comentarios más populares</h2>
    	<ul class="comments">
        {% for c in top_comments %}
            <li class="suggestion-element" {% if forloop.last %}style="border-bottom:1px dotted #BBBBBB"{% endif %}>
                <!-- Añadimos el botón de borrar comentario-->
                {% if c.user.username = user.username %}
                    <div class="removable" value="{{c.id}}" type="comment"><a href="#">Remove</a></div>
                {% endif %}
                                        
                <span class="user"><img src="{% url user_avatar c.user.username %}" alt="{{c.user.username}} avatar"></span>
                <div class="comment-content">
                    <span class="msg"><a href="{% url fb_public_profile c.user.username%}" class="black-link">{{c.user.username}}</a>: {{c.msg}}</span>
                    <span class="timestamp">{{c.created|naturaltime}}</span> 
                    {% if c.username != user.username %} 
						<span class="action-bar" style="display:none">
							&nbsp;- 
							<span class="like-dislike" value="{{c.id}}" {% if c.has_voted %}like="true"{%endif%} type="comment">
								<span class="dislike">
									<span class="hoverlink">Ya no me gusta</span> 
									<span class="text like-text {% if not c.has_voted %}increase{% endif %}">{{c.vote_counter}}</span> personas
								</span>
								
								<span class="like">
									<span class="hoverlink">Me gusta</span> 
								</span>
							</span>
						</span>
                    {% endif %}
                </div>
            </li>
        {% endfor %}

    	</ul>
    {% endif %}
	
	<h2>¿Tienes algún comentario?</h2>
    <textarea id="msg"></textarea>
    <span class="btn" onclick="sendComment(this,'list',{{list.id}});">Comentar</span>
	
    {% if comments.1 %}
		<h2>Comentarios</h2>
    	<ul class="comments" id="comment-list">
        {% for c in comments.1 %}
            <li class="suggestion-element" {% if forloop.last %}style="border-bottom:1px dotted #BBBBBB"{% endif %}>
                
                <!-- Añadimos el botón de borrar comentario-->
                {% if c.username = user.username %}
                    <div class="removable" value="{{c.id}}" type="comment"><a href="#">Remove</a></div>
                {% endif %}
                                        
                <span class="user"><img src="{% url user_avatar c.username %}" alt="{{c.username}} avatar"></span>
                <div class="comment-content">
                    <span class="msg"><a href="{% url fb_public_profile c.username%}" class="black-link">{{c.username}}</a>: {{c.msg}}</span>
                    <span class="timestamp">{{c.created|naturaltime}}</span> 
                    {% if c.username != user.username %} 
						<span class="action-bar" style="display:none">
							&nbsp;- 
							<span class="like-dislike" value="{{c.id}}" {% if c.has_voted %}like="true"{%endif%} type="comment">
								<span class="dislike">
									<span class="hoverlink">Ya no me gusta</span> 
									<span class="text like-text {% if not c.has_voted %}increase{% endif %}">{{c.vote_counter}}</span> personas
								</span>
								
								<span class="like">
									<span class="hoverlink">Me gusta</span> 
								</span>
							</span>
						</span>
                    {% endif %}
                </div>
            </li>
        {% endfor %}

    	</ul>
    {% endif %}

    
	</div>
	
	<script id="commentTemplate" type="text/x-jquery-tmpl">
        <li>
			<div class="removable" value="${id}" type="comment"><a href="#">Remove</a></div>
            <span class="user">
				<img class="user-picture" src="{% url user_avatar user.username %}" alt="user avatar">
			</span>
			<div class="comment-content">
				<span class="msg">
					<a href="{% url fb_public_profile user.username %}" class="black-link">{{user.username}}</a>: 
					${msg}
				</span>
			
				<span class="timestamp">0 minutes ago</span>
            </div>

        </li>
    </script>  
{%endblock%}
