{% extends "base.html" %}

{% load i18n %}
{% load humanize %}

{% block title %}Ver sugerencia{% endblock %}
{% block extra_js %}
    <script src="/static/webapp/js/jquery.tmpl.min.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
       
       
        setBehaviourToSuggestion();
    });
    
    function setBehaviourToSuggestion(){
        //Behaviour to: show and hide "Like" text on class suggestion-element
       $('.suggestion-element').hover(
           function(){$(this).find('.like').css('visibility','visible');},
            function(){$(this).find('.like').css('visibility','hidden');}
        );
    }
    
    function sendComment(obj){
        if($('#msg').val()=="")
            return false;
        $(obj).text("Enviando")
        $(obj).addClass("waiting")
        
        $.ajax({
            type: "POST",
            url: "/ajax/add/comment/event/",
            data: {
                instance_id:{{suggestion.id}},
                msg:$('#msg').val()
            },
            complete: function(msg){
                if (msg.status !=200){

                }else{
                    var message=$('#msg').val()
                    $('#msg').val("")
                    
                    var response=jQuery.parseJSON(msg.responseText);
                    
                    
                    //console.log(response.msg)
                    $('#commentTemplate').tmpl( {
                        msg: response.msg,
                        comment_id: response.id,
                    }).prependTo('#comment-list');
                    
                    setBehaviourToSuggestion();
                }
                $(obj).val("Enviar")
                $(obj).removeClass("waiting")
            }
        });
    }
    </script>
{%endblock%}

{% block body %}
    <div id="view-suggestion">
        <div id="autor">
            <img src="/user/{{suggestion.user.username}}/picture/" alt="{{suggestion.user.username}} avatar">
            <p>
                <a href="/fb{{suggestion.user.get_absolute_url}}">{{suggestion.user.username}}</a>
                sugiere:
            </p>
        </div>
        <div class="suggestion">
            <h1>{{suggestion.name}}</h1>
            {% if suggestion.description %}
                <p><strong>Instrucciones/explicación</strong>: {{suggestion.description}} </p>
            {% endif %}    

            <a title="Más detalles sobre: {{suggestion.poi.name}}" href="/fb{{suggestion.poi.get_absolute_url}}"><img src="http://maps.googleapis.com/maps/api/staticmap?center={{suggestion.poi.location}}&zoom=14&size=210x100&maptype=roadmap
&markers=color:blue%7Clabel:S%7C{{suggestion.poi.location}}&sensor=false"></a>
            
            <p>
                <strong>Lugar</strong>: <a href="/fb{{suggestion.poi.get_absolute_url}}">{{suggestion.poi.name}}</a>, <br>
                <strong>Dirección</strong>: {{suggestion.poi.address}}<br>
                <strong>Fecha</strong>: [25/04/2011 al 30/05/2011]<br>
                <strong>Palabras clave</strong>: <a href="">ocio</a> | <a href="">granada</a><br>
            </p>

            <p>Reportar localización errónea</p>
<!--
            <p>Reportar sugerencia duplicada</p>
-->
        </div>
        <span class="btn likeBtn">Me gusta</span>
        <span class="btn likeBtn">Recordar</span>
        
        
        <p class="popular">Comentario más popular</p>
        <div id="comments" class="comments suggestion-element">
            <span class="user"><img src="/user/susana/picture/" alt="user avatar"><br><a href="">Pack</a></span>
            <span class="msg">Deberíais tomar unas cerveza mientras</span>
            <span class="timestamp">
                hace 5 min
                <span class="hoverlink like">Me gusta</span>
            </span>
        </div>
        <p class="clear big">¿Tienes algo que añadir a esta sugerencia?</p>
        <textarea id="msg"></textarea>
        <ul id="feeling">
            <li>Happy</li>
            <li>Glad</li>
            <li>Sad</li>
        </ul>
        <span class="btn" onclick="sendComment(this)">Comentar</span>
        
        {% if comments %}
        <ul class="comments" id="comment-list">
            {% for c in comments.1 %}
                <li class="suggestion-element">
                    <span class="user"><img src="/user/{{c.username}}/picture/" alt="{{c.username}} avatar"><br><a href="">{{c.username}}</a></span>
                    <span class="msg">{{c.msg}}</span>
                    <span class="timestamp">
                        {{c.created|timesince}}
                        {% if c.has_voted %}
                            <span class="hoverlink like">Ya no me gusta</span>
                        {% else %}
                            <span class="hoverlink like">Me gusta</span>
                        {% endif %}
                    </span>
                </li>
            {% endfor %}
<!--
            <li class="suggestion-element">
                <span class="user"><img src="/user/susana/picture/" alt="user avatar"><br><a href="">Pack</a></span>
                <span class="msg">Deberíais tomar unas cerveza mientras</span>
                <span class="timestamp">
                    hace 5 min
                    <span class="hoverlink like">Me gusta</span>
                </span>
            </li>
-->
        </ul>
        {% endif %}
    </div>
    
    <script id="commentTemplate" type="text/x-jquery-tmpl">
        <li class="suggestion-element">
                <span class="user"><img src="/user/{{user.username}}/picture/" alt="user avatar"><br><a href="">{{user.username}}</a></span>
                <span class="msg">${msg}</span>
                <span class="timestamp">
                    hace 0 min
                    <span class="hoverlink like">Me gusta</span>
                </span>
            </li>
    </script>
{% endblock %}
