{% extends "base.html" %}

{% load i18n %}
{% load tags %}

{% block title %}Ver sugerencia{% endblock %}
{% block extra_js %}
    <script src="/static/webapp/js/jquery.tmpl.min.js"></script>
    <script src="/static/facebookApp/js/grm.js"></script>
    
    
    <script type="text/javascript">
    $(document).ready(function(){
        resizeIframe();
        $('#comment-list li,#popular-comments li').hover(
            function(){$(this).find('.action-bar').show()},
            function(){$(this).find('.action-bar').hide()}
        )
    });    
    </script>
{%endblock%}

{% block body %}
    <div id="view-suggestion">
        <div id="autor">
            <a href="/user/{{suggestion.user.username}}/picture/"><img src="/user/{{suggestion.user.username}}/picture/" alt="{{suggestion.user.username}} avatar"></a>
            <p>
                <a href="{% url fb_public_profile suggestion.user.username %}">{{suggestion.user.username}}</a>
                sugiere:
            </p>
        </div>
        <div class="suggestion">
            <h1>{{suggestion.name}}</h1>

            <a title="Más detalles sobre: {{suggestion.poi.name}}" href="{{suggestion.poi.get_absolute_fburl}}"><img src="http://maps.googleapis.com/maps/api/staticmap?center={{suggestion.poi.location}}&zoom=14&size=210x100&maptype=roadmap
&markers=color:blue%7Clabel:S%7C{{suggestion.poi.location}}&sensor=false"></a>
            
            {% if suggestion.description %}
                <p><strong>Instrucciones/explicación</strong>: {{suggestion.description}} </p>
            {% endif %}    
            
            <p>
                 <strong>Lugar</strong>: <a href="{{suggestion.poi.get_absolute_fburl}}">{{suggestion.poi.name}}</a>
            </p>
            <p>
                <strong>Dirección</strong>:<br>
                <a href="http://maps.google.com/maps?q={{suggestion.poi.address}}&t=h&z=16" class="black-link" target="_blank">{{suggestion.poi.address}}</a>
                
            </p>
            {% if suggestion.date_starts or suggestion.date_ends %}
            <p>
                    <strong>Fecha</strong>: 
                    [25/04/2011 al 30/05/2011]<br>
                {% endif %}
            </p>
            {% if suggestion.tags %}
                <p id="tag-list-label"><strong>Palabras clave</strong>:</p> 
                <ul id="tag-list">
                {% for tag in suggestion.tags %}
                    <li>
<!--
                        <form action="{% url fb_search_suggestions tag %}" method="post">
                            <input type="hidden" name="suggestion" value="suggestion">
                            <input type="submit" value="{{tag}}">
                        </form>
-->
                        {{tag}}
                        {%if not forloop.last %}, {%endif%}
                    </li>
                {% endfor %}
                </ul>
            {% endif %}

<!--
            <p>Reportar localización errónea</p>
            <p>Reportar sugerencia duplicada</p>
-->
        </div>

        {% if suggestion.user.username != user.username %}
        
                <span class="likeBtn btn">
                    <span class="like-dislike" value="{{suggestion.id}}" {% if has_voted %}like="true"{%endif%} type="comment">
                        <span class="dislike">
                            <span class="text like-text {% if not has_voted %}increase{% endif %}">{{vote_counter}}</span><br>
                            <span class="hoverlink">Ya no me gusta</span> 
                        </span>
                        
                        <span class="like">
                            <span class="black">{{vote_counter}}</span><br>
                            <span class="text like-text" >Me gusta</span> 
                        </span> 
                    </span>
                </span>
            
            
            
            <span class="btn likeBtn" id="save-btn">Guardar</span>
        {% endif %}
        
        {% if top_comments %}
            <div id="popular-box" class="clear">
                <p class="popular">Los comentarios más populares</p>
                <ul class="comments" id="popular-comments">
                    {% for c in top_comments %}
                        <li class="comment-element" {% if forloop.first %}style="border-top:0px"{% endif %}>
                    
                            <!-- Añadimos el botón de borrar comentario-->
                            {% if c.user.username = user.username %}
                                <div class="removable" value="{{c.id}}" type="comment"><a href="#">Remove</a></div>
                            {% endif %}
                                                    
                            <span class="user"><img src="{% url user_avatar c.user.username %}" alt="{{c.user.username}} avatar"></span>
                            <div style="float:left;width:460px;">
                                <span class="msg"><a href="{% url fb_public_profile c.user.username%}" class="black-link">{{c.user.username}}</a>: {{c.msg}}</span>
                                <span class="timestamp">{{c.created|naturaltime}}</span> 
                                {% if c.user.username != user.username %}
                                    <span class="action-bar" style="display:none">
                                        &nbsp;-
                                        <span class="like-dislike" value="{{c.id}}" {% if c.has_voted %}like="true"{%endif%} type="comment">
                                            <span class="dislike">
                                                <span class="hoverlink">Ya no me gusta</span> 
                                                <span class="text like-text {% if not c.has_voted %}increase{% endif %}">{{c.vote_counter}}</span> personas
                                            </span>
                                            
                                            <span class="like">
                                                <span class="hoverlink">Me gusta</span> 
                                            </span>
                                        </span>
                                    </span>
                                {% endif %}
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
        
        <p class="clear big">¿Tienes algo que añadir a esta sugerencia?</p>
        <textarea id="msg"></textarea>
<!--
        <ul id="feeling">
            <li>Happy</li>
            <li>Glad</li>
            <li>Sad</li>
        </ul>
-->
        <span class="btn" onclick="sendComment(this,'event',{{suggestion.id}});">Comentar</span>
        
        {% if comments %}
        <ul class="comments" id="comment-list">
            {% for c in comments.1 %}
                <li class="suggestion-element" {% if forloop.last %}style="border-bottom:1px dotted #BBBBBB"{% endif %}>
                    
                    <!-- Añadimos el botón de borrar comentario-->
                    {% if c.username = user.username %}
                        <div class="removable" value="{{c.id}}" type="comment"><a href="#">Remove</a></div>
                    {% endif %}
                                            
                    <span class="user"><img src="{% url user_avatar c.username %}" alt="{{c.username}} avatar"></span>
                    <div style="float:left;width:460px">
                        <span class="msg"><a href="{% url fb_public_profile c.username%}" class="black-link">{{c.username}}</a>: {{c.msg}}</span>
                        <span class="timestamp">{{c.created|naturaltime}}</span> 
                        {% if c.username != user.username %}
                            <span class="action-bar" style="display:none">
                                &nbsp;- 
                                <span class="like-dislike" value="{{c.id}}" {% if c.has_voted %}like="true"{%endif%} type="comment">
                                    <span class="dislike">
                                        <span class="hoverlink">Ya no me gusta</span> 
                                        <span class="text like-text {% if not c.has_voted %}increase{% endif %}">{{c.vote_counter}}</span> personas
                                    </span>
                                    
                                    <span class="like">
                                        <span class="hoverlink">Me gusta</span> 
                                    </span>
                                </span>
                            </span>
                        {% endif %}
                        
                    </div>
                </li>
            {% endfor %}

        </ul>
        {% endif %}
        {% if comments.1|length == 8 %}
            <div class="load-more">Cargar más</div>
        {% endif %}
    </div>
    
    <script id="commentTemplate" type="text/x-jquery-tmpl">
        <li class="suggestion-element">
            <span class="user"><img src="/user/{{user.username}}/picture/" alt="{{user.username}} avatar"></span>
            <div style="float:left;width:460px">
                <span class="msg"><a href="{% url fb_public_profile user.username%}" class="black-link">{{user.username}}</a>: ${msg}</span>
                <span class="timestamp">0 minutes ago</span>
            </div>
        </li>
    </script>
{% endblock %}
