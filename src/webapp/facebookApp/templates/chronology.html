{% extends "base.html" %}
{% load i18n %}
{% url fb_notifications as notifications_section %}
{% load tags %}
{% block extra_js %}
    <script src="/static/webapp/js/jquery.tmpl.min.js"></script>
    <script src="/static/facebookApp/js/grm.js"></script>
    <script src="/static/facebookApp/js/social.js"></script>   
    <script src="/static/facebookApp/js/chronology.js"></script>
    
    <script type="text/javascript">
        $(document).ready(function(){
            
            //Adding behaviour to tab content
            $('#tabMenu li').not('.clear-box').click(function(){
                tab_id=$('#tabMenu li.active').attr('id')
                $('#'+tab_id+'_content').addClass('hidden');
                $('#tabMenu li.active').removeClass('active');
                
                tab_id=$(this).attr('id')
                $('#'+tab_id+'_content').removeClass('hidden');
                $(this).addClass('active');
            })
            
            $('#filter-suggestions').click(function(){
                $('#chronology li.msg-300').show();
                //Oculto todos aquellos que no son sugerencias
                $('#chronology li').not('.msg-300').not('.suggestion-comment').hide();
            });
            
            $('#filter-lists').click(function(){
                $('#chronology li.msg-350').show();
                //Oculto todos aquellos que no son sugerencias
                $('#chronology li').not('.msg-350').not('.suggestion-comment').hide();
            });
            
            $('#filter-likes').click(function(){
                $(':regex(class,(msg-125|msg-305|msg-355))').show();
                //Ocultamos aquellos que no son 125 ni 355
                $('#chronology li').not('.msg-125').not('.msg-305').not('.msg-355').hide()  
            });
                
            $('#filter-comments').click(function(){
                $(':regex(class,(msg-120|msg-121))').show();
                //Oculto todos aquellos que no son sugerencias
                $('#chronology li').not('.msg-120').not('.msg-121').hide();
            });
            
            $('#no-filter').click(function(){
                //Muestro todos
                $('#chronology li').show();
            });
            
            $('.user-picture').each(function(i,elem){
                
                (new Image()).src = $(elem).attr('src')
            })
            
            GRM.updateTabCounters();
            
            $(".load-more").click(function(){
                GRM.loadPage({
                    page:page,
//                    "total_pages":{{suggestions.2}},
                    container:'#chronology',
                    url:'{% url get_activity_timeline %}',
                    template: "#suggestionTemplate",
                    data:{
                            'query_id':"{{chronology.0}}",
                        }                
                });
            });
            
        });
    </script>
    
{%endblock%}

{% block embed_js %}{%endblock%}

{% block title %}Dashboard{% endblock %}
{% block goBack %}{%endblock%}
{% block body %}
    <div {% block id %} {%endblock%} class="clear">
        
        {% block pre_chronology %} {%endblock%}
        {% if chronology.1|length %}    
    
            
            
    
            
            <ul id="tabMenu" class="clear">
                <li class="clear-box">Ver:</li>
                <li id="no-filter" class="active">Todo <span id="all-counter"></span></li>
                <li id="filter-suggestions">Sugerencias <span id="suggestions-counter"></span></li>
                <li id="filter-lists">Listas <span id="lists-counter"></span></li>
                <li id="filter-likes">Valoraciones <span id="likes-counter"></span></li>
                <li id="filter-comments">Comentarios <span id="comments-counter"></span></li>
                
            </ul>
            <ul id="chronology">
            {% for obj in chronology.1 %}
                {% if not obj.msg_id = 100 or not obj.is_private %}
                
                    <li {% if forloop.last %} style="border:0" {% endif %} class="msg-{{obj.msg_id}}{% if forloop.counter <= notifications %} unread-item{% endif %}">
                        {% timeline_item obj %}
                    </li>
                {% endif %}

            {% endfor %}
            </ul>
        
            <!-- Si hay más mensajes -->
            {% if chronology.1|length > 9%}
                <div class="load-more">Cargar más</div>
            {% endif %}    
            
            
        {% endif %}    
    
        
        {% block pos_chronology %}{%endblock%}

    </div>


    
    
    <script id="commentTemplate" type="text/x-jquery-tmpl">
        <li>
            <img class="user-picture" src="{% url user_avatar user.username %}" alt="user avatar"><a href="{% url fb_public_profile user.username %}">{{user.username}}</a>: ${msg}<br>
            <span class="timestamp">0 minutes ago</span> - 
            
            
            <span class="like-dislike" value="${id}" type="comment">

                <span class="dislike" style="display:none;">
                    <span class="hoverlink">Ya no me gusta</span> 
                    <span class="text like-text">1</span> personas
                </span>
                
                <span class="like">
                    <span class="hoverlink">Me gusta</span> 
                </span>
            </span>
        </li>
    </script>    
{% endblock %}

