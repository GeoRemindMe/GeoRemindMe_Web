{% extends "base.html" %}
{% load tags %}
{% load filters %}

{% block title %}Mochila con tus sugerencias y listas favoritas{% endblock %}

{% block extra_js %}
    {% if request.META.REMOTE_ADDR = "127.0.0.1" %}
        <script type="text/javascript" src="/static/common/js/bag.js"></script>    
    {% else %}
        <script type="text/javascript" src="/static/common/js/bag.min.js"></script>    
    {% endif %}
    
{%endblock%}

{% block goBack %}{%endblock%}
{% block body %}
    {% if not user.twitter_user %}
        <script type="text/javascript">
             // Add a script element as a child of the body
             function downloadJSAtOnload() {
                 var element = document.createElement("script");
                 element.src = "https://platform.twitter.com/widgets.js";
                 document.body.appendChild(element);
             }

             // Check for browser support of event handling capability
             if (window.addEventListener)
                window.addEventListener("load", downloadJSAtOnload, false);
             else if (window.attachEvent)
                window.attachEvent("onload", downloadJSAtOnload);
             else 
                window.onload = downloadJSAtOnload;
        </script>
    {% endif %}

    <div id="suggestions">
        <h1>Tu mochila</h1>
        <div id="legend">Tipo de contenido: 
			<ul>
				<li><span class="mine">&nbsp;</span>Generado por ti</li>
				<li><span class="not-mine">&nbsp;</span>Guardado</li>
			</ul>
		</div>
        <ul id="tabMenu">
            <li id="your_suggestions" class="active">Sugerencias (<span id="suggestions-tab-counter">{{suggestions.1|length}}</span>)</li>
            <li id="suggestions_lists">Listas (<span id="lists-tab-counter">{{lists|length}}</span>)</li>
        </ul>
        <div id="content">
                <!-- YOUR SUGGESTIONS -->
                <span id="your_suggestions_content" class="tab-content">
                    <div id="header">
                        <span class="selectCheckBox"><input type="checkbox" id="checkBox_all" /></span>
<!--
                        <span class="btn right nextBtn {% if user.counters.suggested < 11 %} hidden {% endif %}" id="next-page" onclick="loadSuggestionsPage('next')">Siguiente</span>
                        <span class="btn right prevBtn hidden" id="prev-page" onclick="javascript:loadSuggestionsPage('prev')">Anterior</span>
-->
                        
                        <span class="btn removeBtn" onclick="removeSuggestions()">Eliminar</span>
                        
                        <!-- Menu desplegable de listas -->
                        <span class="btn dropDownBtn">
                            <span class="save-at">Guardar en <img src="/static/common/img/transparent.gif"></span>
                            <ul class="submenu" style="display:none" id="dropdown-list">
                                {% if lists %}
                                    {% for obj in lists %}
                                        {% if obj.user.username = request.user.username %}
                                            <!-- Solo se muestran mis listas -->
                                            <li id="listid-{{obj.id}}">{{obj.name}} (<span class="list-{{obj.id}}-counter">{{obj.keys|length}}</span> sugerencias)</li>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                                <li class="new-list-btn">
                                    <span id="text">Nueva lista...</span>
                                    <span class="new-list" style="display:none"><input type="text" /></span><div id="cancel-link" onclick="closeDropdown()" style="display:none">Cancel</div>
                                </li>
                            </ul>
                        </span>
                        <!-- Fin -->
                        
                        <span class="btn removeBtn filter"><input type="text" id="filter-suggestions" placeholder="Filtrar por nombre"></span>
                        <span class="btn removeBtn" id="filterMySuggestions">Mis sugerencias</span>
                    </div>
                    
                    <!-- Objetos Suggestion-->
                    {% if user.counters.suggested = 0 and suggestions_following|length = 0 %}
                        <div id="noSuggestions" class="tab-content">
                            <span>
                                Aún no has hecho ninguna sugerencia, para empezar:<br>
                                <a href="{% url2 in_facebook add_suggestion %}" id="btn-add-suggestion">Añade una sugerencia</a>
                            </span>
                        </div>
                    {% else %}
                    <span id="suggestion-list" class="tab-content">
                        {% for k in suggestions.1%}
                            <div id="suggestion_{{k.id}}" class="suggestion{% if k.user.username != user.username%} not-mine{%endif%}">
                                <div class="maximize-minimize suggestionCollapsed"><span>.</span></div>
                                <div class="collapsed">
                                    <span class="checkBox"><input type="checkbox" id="checkBox_{{k.id}}" value="{{k.id}}" name="suggestions" /></span>
                                    <span class="suggestionName">{{k.name}}</span>
                                    <span class="suggestionName_editable" style="display:none"  value="{{k.id}}">{{k.name}}</span>
                                </div>
                                <div class="expanded" style="display:none">
                                    <dl> 
                                    
                                        {% if k.user.username != user.username%}
                                            <dt>
                                                Autor:
                                                <div class="help-icon">
                                                    <img src="/static/common/img/transparent.gif" alt="Help"  id="help-suggestion">
                                                </div>
                                            </dt>
                                            <dd>
                                                <a href="{% url2 in_facebook public_profile k.user.username %}">{{k.user.username}}</a>
                                            </dd>
                                        {%endif%}
                                        
                                        {%if k.description or not k.user.username != user.username %}
                                        <dt>Descripción:</dt>
                                        <dd class=" {% if k.user.username == user.username%}editable_description{% endif %}" type="textarea" value="{{k.id}}">{%if k.description %}{{k.description|linebreaksbr}}{% else %}{% endif %}</dd>
                                        {%endif%}
                                        
                                        <dt>Lugar:</dt>
                                        <dd style="width:390px">
                                            <a class="placeName" href="{% url2 in_facebook view_place k.poi.slug%}">{{k.poi.name}}</a> ({{k.poi.address}}) 
<!--
                                             {% if k.user.username == user.username%}<a href="{% url2 in_facebook edit_suggestions k.id %}">Editar</a>{% endif %}
-->
                                        </dd>
                                        
                                        {% if k.user.username != user.username and k.tags|length = 0 %}
                                        {%else%}
                                            <dt>Tags:</dt>
                                            <dd style="width:390px" {% if k.user.username == user.username%}class="editable_tags"{%endif%} type="tags" value="{{k.id}}">{% for tag in k.tags %}{{tag}}{% if not forloop.last %}, {%endif%}{% endfor %}</dd>
                                        {% endif %}
                                            

                                        
                                        <dt>Fecha:</dt>
                                        <dd class="{% if k.user.username == user.username%}editable{% endif %} datepicker">
                                            <span class="datetime">
                                                <span class="black-link">
                                                {% if k.date_starts or k.date_ends or k.hour_starts or k.hour_ends %}
                                                    [
                                                    {% if k.hour_starts %}
                                                        {{k.hour_starts}}
                                                    {% endif %}
                                                    {% if k.date_starts  %}
                                                        {{k.date_starts|naturaltime}}
                                                    {% else %}
                                                        {{k.created|naturaltime}}
                                                    {% endif %}
                                                     -
                                                    {% if k.hour_ends %}
                                                        {{k.hour_ends}}
                                                    {% endif %}
                                                    {% if k.date_ends %}
                                                        {{k.date_ends|naturaltime}}
                                                    {% else %}
                                                        Sin fecha de fin
                                                    {% endif %}
                                                    ]
                                                {% else %}
                                                    Se puede hacer en cualquier momento
                                                {% endif %}
                                                </span> 
<!--
                                                <span class="hoverlink" onclick="javascript:$(this).parent().siblings('.datetime-edition').show();$(this).parent().hide()">Editar</span>
-->
                                            </span>
                                            <div class="datetime-edition" style="display:none">
                                                De <input title="Fecha de inicio" size="9" class="date-type start-date" autocomplete="off" {% if k.date_starts != None %}value="{{k.date_starts}}"{%else%}{% endif %} placeholder="mm/dd/aa" {% if obj.user.username = request.user.username %}readonly{%endif%}>
                                                <input title="Hora de inicio" size="9" class="hour-type start-hour" autocomplete="off"  placeholder="hh:mm" {% if obj.user.username = request.user.username %}readonly{%endif%}>
                                                a
                                                <input title="Fecha de fin" size="9" class="date-type end-date" autocomplete="off" {% if k.date_ends != None %}value="{{k.date_ends}}"{%else%}{% endif %} placeholder="mm/dd/aa" {% if obj.user.username = request.user.username %}readonly{%endif%}>
                                                <input title="Hora de fin" size="9" class="hour-type end-hour" autocomplete="off" placeholder="hh:mm" {% if obj.user.username = request.user.username %}readonly{%endif%}>
                                                <span class="anytime"><input type="checkbox" checked> <span>Se puede hacer en cualquier momento</span></span><span class="btn">Guardar</span><span onclick="javascript:$(this).parent().siblings('.datetime').show();$(this).parent().hide()" class="hoverlink">Cancelar</span>
                                            </div>
                                        </dd>
                                        
                                        
                                        <dt>Mis listas:</dt>
                                        <dd style="width:390px">
                                                <ul class="removable-sugestion-list" {% if k.lists|length = 0 %}style="display:none"{% endif %}>
                                                    {% for obj in k.lists %}
                                                        {% if obj.user.username = request.user.username %}
                                                            <li class="list_{{obj.id}} removable" value="{{k.id}}">{{obj.name}}</li>
                                                        {% endif %}
                                                    {% endfor %}
                                                </ul>
                                            
                                                
                                                <em class="empty-msg add-on-list" value="{{k.id}}">
                                                    Haz clic aquí para añadir a una lista
                                                </em>
                                            
                                        </dd>
                                        <dt>URL:</dt>
										<dd><input type="text" value="{{ k.short_url }}" class="short_url" readonly>  <a href="{{ k.short_url }}">Vista previa</a></dd>
                                        <dt class="share-row"><strong>Compartir:</strong></dt>
                                        <dd class="share-row">
                                            <ul class="share-suggestion">
                                                <!--
                                                <li><a class="share-suggestion georemindme-icon" href="">Sugerir a amigos</a></li>
-->
                                                <li class="share" type="twitter" data-href="{{ k.short_url }}" value="{{k.id}}" data-type="event"><a class="share-suggestion twitter-icon" href="">Twitter</a></li>
                                                {% if user.facebook_user %}
                                                    <li class="share" type="wall" data-href="{{ k.short_url }}" value="{{k.id}}" data-type="event"><a class="share-suggestion facebook-icon" href="">Muro</a></li>
                                                {% endif %}
                                            </ul>
                                        </dd>
                                        
                                        <dt>Visibilidad:</dt>
                                        <dd {% if k.user.username == user.username%}class="editable_visibility"{%endif%} value="{{k|private:'_get_visibility'}}">{% if k|private:"_get_visibility" = "public" %}Pública{%else%}Privada{%endif%}</dd>
                                        
                                    </dl>
                                    
                                    
			
                                    <div class="show-more-text" style="display:none">
                                        <p class="big statistics">Estadísticas:</p>
                                        <dl>
                                            
                                            <dt>Valoraciones recibidas: </dt>
                                            <dd>{{k.counters.votes}}</dd>
                                            
                                            <dt>Personas que han guardado la sugerencia: </dt>
                                            <dd>{{k.counters.followers}}</dd>
                                            
                                            <dt>Comentarios recibidos:</dt>
                                            <dd>{{k.counters.comments}}</dd>
                                            
                                            <dt>Última modificación:</dt>
                                            <dd>{{k.modified}}</dd>
                                        </dl>
                                    </div>
                                    <span class="show-more">Mostrar estadísticas</span>
                                    
                                </div>
                                
                            </div>
                            
                            
                        {% endfor%}   
                    </span>           
                    {% endif %}
                </span>
                <!-- END YOUR SUGGESTIONS -->
                    
                    
                    
               
                
                
                
                <!-- LISTS -->
                <span id="suggestions_lists_content" class="tab-content hidden">
                    <div id="header">
                        <span class="selectCheckBox"><input type="checkbox" id="checkBoxList_all" /></span>
<!--
                        <span class="btn right nextBtn {% if user.counters.suggested < 11 %} hidden {% endif %}" id="next-page" onclick="loadSuggestionsPage('next')">Siguiente</span>
                        <span class="btn right prevBtn hidden" id="prev-page" onclick="javascript:loadSuggestionsPage('prev')">Anterior</span>
-->
                        
                        <span class="btn removeBtn" onclick="removeLists()">Eliminar</span>

                        <span class="btn addNewList" onclick="javascript:$('#your_suggestions').click();$('#your_suggestions_content .dropDownBtn').click();$('.new-list-btn span').click()">
                            Nueva lista 
                        </span>
                        <span class="btn removeBtn" id="filterMyLists">Mis listas</span>                    
                        <span class="btn removeBtn filter"><input type="text" id="filter-lists" placeholder="Filtrar por nombre"></span>
                        
                    </div>

                    
                        <div id="suggestion-list-lists">
                        
                        {% if lists %}
                            {% for obj in lists %}
                                <div id="list_{{obj.id}}" class="suggestion suggestionList{% if obj.user.username != user.username%} not-mine{%endif%}">
                                    <div class="maximize-minimize suggestionCollapsed"><span>.</span></div>
                                    <div class="collapsed">
                                        <span class="checkBox"><input type="checkbox" id="checkBoxList_{{obj.id}}" value="{{obj.id}}" name="lists" /></span>
                                        <span class="suggestionName">{{obj.name}}</span>
                                        <span class="suggestionName_editable {% if obj.user.username == user.username%}editable_list_name{% endif %}" style="display:none">{{obj.name}}</span>                                        
                                    </div>
                                    <div class="expanded" style="display:none">
                                        <dl>
                                            {% if obj.user.username != user.username%}
                                                <dt>Autor:</dt>
                                                <dd><a href="{% url2 in_facebook public_profile obj.user.username %}">{{obj.user.username}}</a></dd>
                                            {% endif %}
                                            <dt>Descripción:</dt>
                                            <dd class="{% if obj.user.username == user.username%}editable_list_description{% endif %}">{%if obj.description%}{{obj.description}}{%endif%}</dd>
                                            
                                            <dt>Sugerencias:</dt>
                                            <dd class="suggestions">
                                                
                                                <ul class="removable-suggestions-in-lists" {% if obj.instances|length = 0 %} style="display:none" {%endif%}>
                                                    {% for k in obj.instances %}
                                                        <li  class="list_{{obj.id}} {% if obj.user.username == user.username%}removable{% endif %}" value="{{k.id}}">{{k}}</li>
                                                    {% endfor %}
                                                </ul>
                                                
                                                <em class="empty-msg {% if obj.user.username == user.username%}editable{% endif %}" value="{{obj.id}}" {% if obj.instances|length > 0 %} style="display:none" {%endif%}>
                                                    No hay sugerencias en esta lista
                                                </em>
                                                
                                            </dd>
                                            
                                            <dt>Tags:</dt>
                                            <dd {% if obj.user.username == user.username%}class="editable_list_tags"{%endif%}>{% if obj.tags %}{% for tag in obj.tags %}{{tag}}{%if not forloop.last%}, {%endif%}{%endfor%}{% endif %}</dd>
                                            <dt>URL:</dt>
											<dd><input type="text" value="{{ obj.short_url }}"> <a href="{{ obj.short_url }}">Previsualizar</a></dd>
                                            <dt><strong>Compartir:</strong></dt>
                                            <dd>
                                                <ul class="share-suggestion">
    <!--
                                                    <li><a class="share-suggestion georemindme-icon" href="">Sugerir a amigos</a></li>
    -->
                                                    <li class="share" type="twitter" data-href="{{ obj.short_url }}" value="{{k.id}}" data-type="list"><a class="share-suggestion twitter-icon" href="">Twitter</a></li>
                                                    <li class="share" type="wall" data-href="{{ obj.short_url }}" value="{{k.id}}" data-type="list"><a class="share-suggestion facebook-icon" href="">Muro</a></li>
                                                </ul>
                                            </dd>
                                            <dt>Visibilidad:</dt>
                                            <dd {% if obj.user.username == user.username%}class="editable_list_visibility"{%endif%} value="{{obj.visibility}}">{% if obj.visibility = "public" %}Pública{%else%}Privada{%endif%}</dd>
                                        </dl>
                                        
                                        <div class="show-more-text" style="display:none">
											<p class="big statistics">Estadísticas:</p>
											<dl>
												
												<dt>Personas que han guardado la lista: </dt>
												<dd>{{obj.counters.followers}}</dd>
												
												<dt>Comentarios recibidos:</dt>
												<dd>{{obj.counters.comments}}</dd>
												
												<dt>Última modificación:</dt>
												<dd>{{obj.modified}}</dd>
											</dl>
										</div>
										<span class="show-more">Mostrar estadísticas</span>
                                    </div>
                                </div>
                            {% endfor %}
						{% endif %}
                        </div>
                    
                </span>
                <!-- END LISTS -->
            </table>
        </div>
    </div>
    
    
    <script id="suggestionTemplate" type="text/x-jquery-tmpl">
        <div id="suggestion_${element.id}" class="suggestion">
            <div class="collapsed">
                <span class="checkBox"><input type="checkbox" id="checkBox_{{element.id}}" value="${element.id}" /></span>
                <span class="suggestionName">${element.name}</span>
<!--
                <span class="suggestionInLists">Lista ${element.id}</span>
-->
            </div>
            <div class="expanded hidden">
                Id:${element.id}<br>
            </div>
        </div>
    </script>
    
    <!-- A MODIFICAR -->
    <script id="listTemplate" type="text/x-jquery-tmpl">
        <div id="list_${obj.id}" class="suggestion suggestionList">
            <div class="maximize-minimize suggestionCollapsed"><span>.</span></div>
            <div class="collapsed">
                <span class="checkBox"><input type="checkbox" id="checkBox_${obj.id}" value="${obj.id}" name="lists" /></span>
                <span class="suggestionName">${obj.name}</span>
                <span class="suggestionName_editable editable_list_name" style="display:none">${obj.name}</span>                                        
            </div>
            <div class="expanded" style="display:none">
                <dl>
                    <dt>Descripción:</dt>
                    <dd class="editable_list_description">Esta lista aún no tiene descripción</dd>
                    
                    <dt>Sugerencias</dt>
                    <dd class="suggestions">
                        
                         <ul class="removable-suggestions-in-lists" style="display:none">
                            {% templatetag openvariable %}each keys{% templatetag closevariable %}
                                <li  class="list_${obj.id} removable" value="${$value.id}">${$value.name}</li>
                            {% templatetag openvariable %}/each{% templatetag closevariable %}
                        </ul>
                        
                        <em class="empty-msg editable" value="nothing">
                            No hay sugerencias en esta lista
                        </em>
                        
                    </dd>
                    
                    <dt>Tags:</dt>
                    <dd class="editable_list_tags">

                        <dd class="editable_list_tags" title="Click to edit..." style="">Esta lista de sugerencias no tiene tags</dd>

                    </dd>
                    <dt>URL:</dt>
					<dd><input type="text" value="${obj.short_url}"> <a href="${obj.short_url}">Previsualizar</a></dd>
                    <dt><strong>Compartir:</strong></dt>
                    <dd>
                        <ul class="share-suggestion">
<!--
							<li class="share" type="link" data-href="${obj.short_url}" data-type="list">
								<a class="share-suggestion link-icon" href="">Enlace</a>
							</li>
-->
							<li class="share" type="twitter" data-href="${obj.short_url}" data-type="list">
								<a class="share-suggestion twitter-icon" href="">Twitter</a></li>
							<li class="share" type="wall" data-href="${obj.short_url}" data-type="list">
								<a class="share-suggestion facebook-icon" href="">Muro</a>
							</li>
                        </ul>
                    </dd>
                    
					<dt>Visibilidad:</dt>
					<dd class="editable_list_visibility" value="public">
                            Pública
					</dd>
                    
                </dl>
                
				<div class="show-more-text" style="display:none">
					<p class="big statistics">Estadísticas:</p>
					<dl>
						
						<dt>Personas que han guardado la lista: </dt>
						<dd>${obj.counters.followers}</dd>
						
						<dt>Comentarios recibidos:</dt>
						<dd>${obj.counters.comments}</dd>
						
						<dt>Última modificación:</dt>
						<dd>${obj.modified}<</dd>
					</dl>
				</div>
				<span class="show-more">Mostrar estadísticas</span>
                
            </div>
        </div>
    </script>
    
    <div class="help-txt" style="display:none" id="share-text" title="Compartir">
        
    </div>
    
    <script id="shareTwitter" type="text/x-jquery-tmpl">
		<p>Envía esta sugerencia a tus seguidores en Twitter.</p>
        <textarea id="twitter_msg" data-id="${elem_id}" event-type="${type}">${link}</textarea>
        <span id="twitter-counter">140</span>
        {% if user.twitter_user %}
			{% comment %}
				Si tiene la cuenta de Twitter asociada le dejamos escribir directamente:
			{% endcomment %}
		{% else %}
			<div style="display:none">
			   <a href="http://twitter.com/share" class="twitter-share-button" target="_blank">Tweet</a>
			</div>
		{% endif %}
    </script>
    <script id="shareFacebook" type="text/x-jquery-tmpl">
		
			<p>Envía esta sugerencia a tu muro de Facebook:</p>
			<textarea id="facebook_msg" data-id="${elem_id}" event-type="${type}">${link}</textarea>
		
    </script>
    
    <div class="help-txt" style="display:none" id="help-suggestion-text" title="Información">
        <p>Solo el autor de una sugerencia puede modificar sus campos descripción, tags y corregir la localización.</p>
        <p>Tu podrás incluir esta sugerencia en cualquiera de tus listas, compartirla con otros usuarios, valorarla y comentarla.</p>
        <p>Además podrás comentar, valorar y guardar en tu baúl aquellas sugerencias y listas de sugerencias que te hayan gustado.</p>
        <p>Si tienes alguna duda o sugerencia puedes hacerla aquí:</p>
        

    </div>
    
    
    
{% endblock %}
