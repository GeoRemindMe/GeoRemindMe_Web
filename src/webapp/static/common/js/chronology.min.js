var lastUID=null;$(document).ready(function(){if($("#followTemplate").length==0){var d='<script id="followTemplate" type="text/x-jquery-tmpl">                        <span  onclick="javascript:follow(\'follow\',${id})"><a href="javascript:void(0)" class="no-following">'+gettext("Seguir")+'</a></span>                    <\/script>                    <script id="unfollowTemplate" type="text/x-jquery-tmpl">                        <span  onclick="javascript:follow(\'unfollow\',${id})"><a href="javascript:void(0)" class="following">'+gettext("Siguiendo")+"</a></span>                    <\/script>";$("#templates").append(d).ready()}var b=[];var a=document.createElement("img");a.src="/static/facebookApp/img/spinning-icons/wait16trans.gif";b.push(a)});function follow(e,a,f){var d={userid:a};if(f!=null){d.username=f}if(e=="follow"){var b="/ajax/add/following/"}else{var b="/ajax/delete/following/"}$("#following_state_"+a).children().text(gettext("Enviado..."));$("#following_state_"+a).removeClass("following-state");$("#following_state_"+a).children().addClass("waiting");$.ajax({type:"POST",url:b,context:d,data:d,complete:function(g){$("#following_state_"+a).children().remove();$("#following_state_"+a).children().removeClass("waiting");if(e=="follow"&&d&&g.status==200){$("#unfollowTemplate").tmpl({id:a}).appendTo("#following_state_"+a);$("#following_state_"+a).addClass("following-state")}else{$("#followTemplate").tmpl({id:a}).appendTo("#following_state_"+a);$("#following_state_"+a).removeClass("following-state")}}})}$(document).ready(function(){setTimelineBehaviour();GRM.updateTabCounters();if($("#activity").length!=0){$(".load-more").attr("type","activity")}else{if($("#public-profile").length!=0){$(".load-more").attr("type","timeline")}else{if($("#notifications").length!=0){$(".load-more").attr("type","notifications")}}}$("#tabMenu li").not(".clear-box").click(function(){tab_id=$("#tabMenu li.active").attr("id");$("#"+tab_id+"_content").addClass("hidden");$("#tabMenu li.active").removeClass("active");tab_id=$(this).attr("id");$("#"+tab_id+"_content").removeClass("hidden");$(this).addClass("active")});$("#filter-suggestions").click(function(){$(":regex(class,(msg-300|msg-303))").show();$("#chronology li").not(".msg-300").not(".msg-303").not(".suggestion-comment").hide()});$("#filter-lists").click(function(){$(":regex(class,(msg-350|msg-353))").show();$("#chronology li").not(".msg-350").not(".msg-353").not(".suggestion-comment").hide()});$("#filter-likes").click(function(){$(":regex(class,(msg-125|msg-305|msg-355))").show();$("#chronology li").not(".msg-125").not(".msg-305").not(".msg-355").hide()});$("#filter-comments").click(function(){$(":regex(class,(msg-120|msg-121))").show();$("#chronology li").not(".msg-120").not(".msg-121").hide()});$("#no-filter").click(function(){$("#chronology li:not(.suggestion-comment)").show()});$(".load-more").loadTimeline({container:"#chronology"})});function setTimelineBehaviour(a){if(typeof a=="undefined"){a=""}else{a='li[value="'+a+'"] '}$(a+".like-dislike").like();$(a+".remember-forget").remember();$(a+".removable").removable();showHideActionBar(a);setCommentsBehaviour(a);markUnreadItems(a)}function markUnreadItems(e){var a=$("#chronology").attr("notifications");if(a!="undefined"){var b=0;var d;if(e==""){d=$("#chronology > li")}else{d=$("#chronology > "+e)}while(a>0&&b<10){$(d[b]).addClass("unread-item");a--;b++}$("#chronology").attr("notifications",a)}}function showHideActionBar(a){$("#chronology "+a+" div.timeline-msg,#chronology "+a+" li.suggestion-comment").hover(function(){$(this).find(".action-bar").css("visibility","visible")},function(){$(this).find(".action-bar").css("visibility","hidden")})}function setCommentsBehaviour(a){$(a+".show-all-comments").click(function(){$(this).parent().find(".long-list").slideDown("fast",function(){$(this).parentsUntil(".suggestion-element").parent().find(".show-all-comments").remove()})});$(a+".focusInput").click(function(){var b=$(this).parentsUntil("li").parent().find(".input-box");if(b.hasClass("hidden")){b.removeClass("hidden")}b.find("textarea").focus()});setCommentFormsBehaviour(a)}function setCommentFormsBehaviour(a){$(a+".commentForm").find("textarea").focus(function(){$(this).css("color","black");if($(this).attr("empty")=="true"){var b=$(this).parent().parent().width()-45;$(this).css("width",b+"px");$(this).css("font-style","normal");$(this).css("font-size","1.1em");$(this).parent().parent().find("img").removeClass("hidden");$(this).attr("msg",$(this).text());$(this).text("")}});$(a+".commentForm").find("textarea").blur(function(){if($(this).val()==""){$(this).attr("empty","true")}if($(this).attr("empty")=="true"){resetInput(this)}});$(a+".commentForm").find("textarea").keyup(function(d){d.preventDefault();if(d.keyCode==13){element_id=$(this).parent().parent().parent().attr("value");parents=$(this).parentsUntil("#chronology");liElement=parents[parents.length-1];if($(liElement).hasClass("msg-350")){sendComment2($(this),element_id,"list")}else{sendComment2($(this),element_id,"event")}$(this).val("");$(this).blur();resetInput(this)}else{var b=(parseInt($(this).val().length/55)+1)*1.2;if($(this).css("height")!=b){$(this).css("height",b+"em")}if($(this).val().length>0){$(this).attr("empty","false")}else{$(this).attr("empty","true")}}})}function resetInput(b){var a=$(b).parent().parent().width()-10;$(b).css("width",a+"px");$(b).css("color","#999");$(b).css("font-style","italic");$(b).css("font-size","0.9em");$(b).parent().parent().find("img").addClass("hidden");$(b).attr("empty","true");$(b).text($(b).attr("msg"));$(b).focusout()}function sendComment2(b,a,d){if(b.val()==""){return false}else{msg=b.val();msg=msg.substring(0,msg.length-1)}GRM.wait();$.ajax({type:"POST",url:"/ajax/add/comment/"+d+"/",dataType:"json",data:{instance_id:a,msg:msg},complete:function(){GRM.nowait()},success:function(e){b.parent();c=$("#commentTemplate").tmpl(e).appendTo("#commentList-"+a);c.find(".like-dislike").like();c.find(".removable").removable()},error:{}})}function suggestionProposal(a,d,e){var b={};if(d=="accept"){b.status=1}else{b.status=2}b.timeline_id=e;asd=a;b.csrfmiddlewaretoken=$(a).parent().find("input").val();GRM.wait();$.ajax({type:"POST",url:url.suggest_suggestion,dataType:"json",data:b,context:$(this),complete:function(){GRM.nowait()},success:function(f){if(f==true){if(d=="accept"){$(a).parent().empty().html(gettext("La propuesta ha sido aceptada"))}else{$(a).parent().empty().html(gettext("La propuesta ha sido rechazada"))}}}})};