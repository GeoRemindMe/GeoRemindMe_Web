(function($){$.fn.editable=function(target,options){if("disable"==target){$(this).data("disabled.editable",true);return}if("enable"==target){$(this).data("disabled.editable",false);return}if("destroy"==target){$(this).unbind($(this).data("event.editable")).removeData("disabled.editable").removeData("event.editable");return}var settings=$.extend({},$.fn.editable.defaults,{target:target},options);var plugin=$.editable.types[settings.type].plugin||function(){};var submit=$.editable.types[settings.type].submit||function(){};var buttons=$.editable.types[settings.type].buttons||$.editable.types.defaults.buttons;var content=$.editable.types[settings.type].content||$.editable.types.defaults.content;var element=$.editable.types[settings.type].element||$.editable.types.defaults.element;var reset=$.editable.types[settings.type].reset||$.editable.types.defaults.reset;var callback=settings.callback||function(){};var onedit=settings.onedit||function(){};var onsubmit=settings.onsubmit||function(){};var onreset=settings.onreset||function(){};var onerror=settings.onerror||reset;if(settings.tooltip){$(this).attr("title",settings.tooltip)}settings.autowidth="auto"==settings.width;settings.autoheight="auto"==settings.height;return this.each(function(){var self=this;var savedwidth=$(self).width();var savedheight=$(self).height();$(this).data("event.editable",settings.event);if(!$.trim($(this).html())){$(this).html(settings.placeholder)}$(this).bind(settings.event,function(e){if(true===$(this).data("disabled.editable")){return}if(self.editing){return}if(false===onedit.apply(this,[settings,self])){return}e.preventDefault();e.stopPropagation();if(settings.tooltip){$(self).removeAttr("title")}if(0==$(self).width()){settings.width=savedwidth;settings.height=savedheight}else{if(settings.width!="none"){settings.width=settings.autowidth?$(self).width():settings.width}if(settings.height!="none"){settings.height=settings.autoheight?$(self).height():settings.height}}if($(this).html().toLowerCase().replace(/(;|")/g,"")==settings.placeholder.toLowerCase().replace(/(;|")/g,"")){$(this).html("")}self.editing=true;self.revert=$(self).html();$(self).html("");var form=$("<form />");if(settings.cssclass){if("inherit"==settings.cssclass){form.attr("class",$(self).attr("class"))}else{form.attr("class",settings.cssclass)}}if(settings.style){if("inherit"==settings.style){form.attr("style",$(self).attr("style"));form.css("display",$(self).css("display"))}else{form.attr("style",settings.style)}}var input=element.apply(form,[settings,self]);var input_content;if(settings.loadurl){var t=setTimeout(function(){input.disabled=true;content.apply(form,[settings.loadtext,settings,self])},100);var loaddata={};loaddata[settings.id]=self.id;if($.isFunction(settings.loaddata)){$.extend(loaddata,settings.loaddata.apply(self,[self.revert,settings]))}else{$.extend(loaddata,settings.loaddata)}$.ajax({type:settings.loadtype,url:settings.loadurl,data:loaddata,async:false,success:function(result){window.clearTimeout(t);input_content=result;input.disabled=false}})}else{if(settings.data){input_content=settings.data;if($.isFunction(settings.data)){input_content=settings.data.apply(self,[self.revert,settings])}}else{input_content=self.revert}}content.apply(form,[input_content,settings,self]);input.attr("name",settings.name);buttons.apply(form,[settings,self]);$(self).append(form);plugin.apply(form,[settings,self]);$(":input:visible:enabled:first",form).focus();if(settings.select){input.select()}input.keydown(function(e){if(e.keyCode==27){e.preventDefault();reset.apply(form,[settings,self])}});var t;if("cancel"==settings.onblur){input.blur(function(e){t=setTimeout(function(){reset.apply(form,[settings,self])},500)})}else{if("submit"==settings.onblur){input.blur(function(e){t=setTimeout(function(){form.submit()},200)})}else{if($.isFunction(settings.onblur)){input.blur(function(e){settings.onblur.apply(self,[input.val(),settings])})}else{input.blur(function(e){})}}}form.submit(function(e){if(t){clearTimeout(t)}e.preventDefault();if(false!==onsubmit.apply(form,[settings,self])){if(false!==submit.apply(form,[settings,self])){if($.isFunction(settings.target)){var str=settings.target.apply(self,[input.val(),settings]);$(self).html(str);self.editing=false;callback.apply(self,[self.innerHTML,settings]);if(!$.trim($(self).html())){$(self).html(settings.placeholder)}}else{var submitdata={};submitdata[settings.name]=input.val();submitdata[settings.id]=self.id;if($.isFunction(settings.submitdata)){$.extend(submitdata,settings.submitdata.apply(self,[self.revert,settings]))}else{$.extend(submitdata,settings.submitdata)}if("PUT"==settings.method){submitdata._method="put"}$(self).html(settings.indicator);var ajaxoptions={type:"POST",data:submitdata,dataType:"html",url:settings.target,success:function(result,status){if(ajaxoptions.dataType=="html"){$(self).html(result)}self.editing=false;callback.apply(self,[result,settings]);if(!$.trim($(self).html())){$(self).html(settings.placeholder)}},error:function(xhr,status,error){onerror.apply(form,[settings,self,xhr])}};$.extend(ajaxoptions,settings.ajaxoptions);$.ajax(ajaxoptions)}}}$(self).attr("title",settings.tooltip);return false})});this.reset=function(form){if(this.editing){if(false!==onreset.apply(form,[settings,self])){$(self).html(self.revert);self.editing=false;if(!$.trim($(self).html())){$(self).html(settings.placeholder)}if(settings.tooltip){$(self).attr("title",settings.tooltip)}}}}})};$.editable={types:{defaults:{element:function(settings,original){var input=$('<input type="hidden"></input>');$(this).append(input);return(input)},content:function(string,settings,original){$(":input:first",this).val(string)},reset:function(settings,original){original.reset(this)},buttons:function(settings,original){var form=this;if(settings.submit){if(settings.submit.match(/>$/)){var submit=$(settings.submit).click(function(){if(submit.attr("type")!="submit"){form.submit()}})}else{var submit=$('<button type="submit" />');submit.html(settings.submit)}$(this).append(submit)}if(settings.cancel){if(settings.cancel.match(/>$/)){var cancel=$(settings.cancel)}else{var cancel=$('<button type="cancel" />');cancel.html(settings.cancel)}$(this).append(cancel);$(cancel).click(function(event){if($.isFunction($.editable.types[settings.type].reset)){var reset=$.editable.types[settings.type].reset}else{var reset=$.editable.types.defaults.reset}reset.apply(form,[settings,original]);return false})}}},text:{element:function(settings,original){var input=$("<input />");if(settings.width!="none"){input.width(settings.width)}if(settings.height!="none"){input.height(settings.height)}input.attr("autocomplete","off");$(this).append(input);return(input)}},textarea:{element:function(settings,original){var textarea=$("<textarea />");if(settings.rows){textarea.attr("rows",settings.rows)}else{if(settings.height!="none"){textarea.height(settings.height)}}if(settings.cols){textarea.attr("cols",settings.cols)}else{if(settings.width!="none"){textarea.width(settings.width)}}$(this).append(textarea);return(textarea)}},select:{element:function(settings,original){var select=$("<select />");$(this).append(select);return(select)},content:function(data,settings,original){if(String==data.constructor){eval("var json = "+data)}else{var json=data}for(var key in json){if(!json.hasOwnProperty(key)){continue}if("selected"==key){continue}var option=$("<option />").val(key).append(json[key]);$("select",this).append(option)}$("select",this).children().each(function(){if($(this).val()==json.selected||$(this).text()==$.trim(original.revert)){$(this).attr("selected","selected")}})}}},addInputType:function(name,input){$.editable.types[name]=input}};$.fn.editable.defaults={name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click.editable",onblur:"cancel",loadtype:"GET",loadtext:"Loading...",placeholder:"Click to edit",loaddata:{},submitdata:{},ajaxoptions:{}}})(jQuery);function show_and_hide_stats_callback(){var a=$(this).parent().find(".show-more-text");if($(a).css("display")!="none"){$(this).html(gettext("Mostrar estadísticas"))}else{$(this).html(gettext("Ocultar estadísticas"))}$(a).toggle("slow")}function create_share_links(){$(".share a").click(function(a){a.preventDefault()});$(".share").click(function(){var a;if($(this).attr("type")=="link"){a="#shareLink";settings={buttons:[],dialogClass:"link-dialog",title:"Compartir enlace",buttons:[{text:"Cerrar",click:function(){$(this).dialog("close")}}]}}else{if($(this).attr("type")=="twitter"){a="#shareTwitter";settings={title:gettext("Compartir en Twitter"),dialogClass:"twitter-dialog",buttons:[{text:gettext("Enviar"),click:function(){var d=$(this).find(".twitter-share-button");if($(d).length!=0){var e=$(this).find("textarea");d.attr("href","http://twitter.com/share?text="+$(e).val()+"&url=");if(d.attr("onclick")===undefined||d.attr("onclick")==null){window.open(d.attr("href"))}else{d.click()}$(this).dialog("close")}else{var c=$(this).find("textarea");var f;if($(c).attr("event-type")=="event"){f={event_id:$(c).attr("data-id"),msg:$(c).val()}}else{f={list_id:$(c).attr("data-id"),msg:$(c).val()}}$.ajax({type:"POST",url:"/ajax/share/twitter/",data:f,context:$(this),success:function(g){$(this).dialog("close")}})}}},{text:gettext("Cancelar"),click:function(){$(this).dialog("close")}}]}}else{if($(this).attr("type")=="wall"){a="#shareFacebook";settings={title:gettext("Compartir en Facebook"),dialogClass:"facebook-dialog",buttons:[{text:gettext("Publicar"),click:function(){var c=$(this).find("textarea");var d;if($(c).attr("event-type")=="event"){d={event_id:$(c).attr("data-id"),msg:$(c).val()}}else{d={list_id:$(c).attr("data-id"),msg:$(c).val()}}$.ajax({type:"POST",url:"/ajax/share/facebook/",data:d,context:$(this),success:function(e){$(this).dialog("close")}})}},{text:gettext("Cancelar"),click:function(){$(this).dialog("close")}}]}}}}var b=$(a).tmpl({type:$(this).attr("data-type"),elem_id:$(this).attr("value"),link:$(this).attr("data-href")});$("#share-text").html(b);setRemainingCharCounter("#twitter_msg","#twitter-counter");$("#id_name").keyup();$("#share-text").dialog(settings);$("#share-text").dialog("open")})}$(document).ready(function(){setExpandible(".suggestion");$("#filter-suggestions").search("#suggestion-list > div",[".suggestionName_editable"]);$("#filter-lists").search("#suggestion-list-lists > div",[".suggestionName_editable"]);$("#checkBox_all,#checkBoxList_all").click(function(){var a=$(this).attr("id");a=a.substring(0,a.length-4);if($("#"+a+"_all").is(":checked")){$(":regex(id,^("+a+"_))").attr("checked",true)}else{$(":regex(id,^("+a+"_))").attr("checked",false)}});set_editable_fields();$(".empty-msg").parent().find("ul").each(function(a,b){if($(b).children().length==0){$(b).hide();$(b).parent().find(".empty-msg").show()}else{$(b).parent().find(".empty-msg").hide()}});$("#tabMenu li").click(function(){tab_id=$("#tabMenu li.active").attr("id");$("#"+tab_id+"_content").addClass("hidden");$("#tabMenu li.active").removeClass("active");tab_id=$(this).attr("id");$("#"+tab_id+"_content").removeClass("hidden");$(this).addClass("active")});$("span.btn.dropDownBtn").menuList();$(".removable-sugestion-list li").click(function(){var b=$(this).attr("class").split(" ")[0];var a=b.substring(5,b.length);removeFromList(this,a)});$("#suggestion-list-lists .suggestions li.removable").click(function(){var b=$(this).attr("class").split(" ")[0];var a=b.substring(5,b.length);removeFromList(this,a)});$(".addNewList").click(function(){});$(".add-on-list").click(function(){$(":regex(id,^(checkBox_))").attr("checked",false);$("#checkBox_"+$(this).attr("value")).attr("checked",true);$(".dropDownBtn").click()});$(".show-more").click(show_and_hide_stats_callback);$("[placeholder]").placeholder();$(".new-list input").css("color","black");$(".new-list input").css("font-style","normal");$("#filterMySuggestions").toggle(function(){$(this).addClass("pressed");var b=$("#suggestion-list .not-mine");b.fadeOut("slow");var a=parseInt($("#suggestions-tab-counter").html());$("#suggestions-tab-counter").html(a-b.length)},function(){$(this).removeClass("pressed");var b=$("#suggestion-list .not-mine");b.fadeIn("slow");var a=parseInt($("#suggestions-tab-counter").html());$("#suggestions-tab-counter").html(a+b.length)});$("#filterMyLists").toggle(function(){$(this).addClass("pressed");$("#suggestion-list .not-mine").fadeOut("slow")},function(){$(this).removeClass("pressed");$("#suggestion-list-lists .not-mine").fadeIn("slow")});create_share_links();$(".date-type").datepicker();$(".datepicker .date-type,.datepicker .hour-type").change(function(){if($(this).val()=="mm/dd/aa"||$(this).val()=="hh:mm"||$(this).val()==""){}else{$(this).parent().find('.anytime [type="checkbox"]').attr("checked",false)}tmp=$(this)});$('.anytime [type="checkbox"]').click(function(){$(this).parent().parent().find(".start-date,.end-date").val("mm/dd/aa");$(this).parent().parent().find(".start-hour,.end-our").val("").blur()});$(".datepicker").find("span").click(function(){$(this).parent().find('[type="checkbox"]').click()})});function updateSuggestions(d){asd=d;var a=d.keys;var b=d.id;var c=d.name;$(a).each(function(h,g){if($("#suggestion_"+g+" .removable-sugestion-list .list_"+b).length==0){var f='<li class="list_'+b+' removable" value="'+g+'">'+c+"</li>";$("#suggestion_"+g+" .removable-sugestion-list ").append(f);var e=$("#suggestion_"+g+" .removable-sugestion-list .list_"+b);e.click(function(){var j=$(this).attr("class").split(" ")[0];var i=j.substring(5,j.length);removeFromList(this,i)});if(e.parent().css("display")=="none"){e.parent().show();e.parent().parent().find(".empty-msg").hide()}}if($("#list_"+b+' .suggestions li[value="'+g+'"]').length==0){$("#list_"+b+" .suggestions ul").append('<li value="'+g+'" class="list_'+b+' removable">'+$("#suggestion_"+g+" .suggestionName_editable").text()+"</li>");$("#list_"+b+' .suggestions ul li[value="'+g+'"]').click(function(){var j=$(this).attr("class").split(" ")[0];var i=j.substring(5,j.length);removeFromList(this,i)});if($("#list_"+b+" .suggestions ul li").length==1){$("#list_"+b+" .suggestions ul").show();$("#list_"+b+" .suggestions .empty-msg").hide()}}})}function removeFromList(b,a){suggestionID=$(b).attr("value");domElement=$(b);$.ajax({type:"POST",url:url.modify_suggestion_list,data:{list_id:[a],suggestions_del:[suggestionID]},dataType:"json",success:function(c){domElement.fadeOut(function(){if($("#suggestion_"+suggestionID+" .removable-sugestion-list li").length==1){$("#suggestion_"+suggestionID+" .empty-msg").fadeIn("slow")}if($(b).parent().children().length==1){$(b).parent().parent().find(".empty-msg").show()}$(b).remove();updateCounter(a,c.keys.length)});if($("#suggestions_lists").hasClass("active")){if($("#suggestion_"+suggestionID+" ul.removable-sugestion-list li").length==1){$("#suggestion_"+suggestionID+" .empty-msg").show()}$("#suggestion_"+suggestionID+" .list_"+a).remove()}else{if($("#list_"+a+" dd.suggestions li").length==1){$("#list_"+a+" dd.suggestions .empty-msg").show()}$("#list_"+a+' li[value="'+suggestionID+'"]').remove()}showMessage(gettext("La sugerencia ha sido eliminada de la lista correctamente"),"success")}})}function submenuLiBehave(c){if($(c).attr("id")=="new-list-btn"){return false}var b={};b.list_id=[$(c).attr("id").substring(7,$(c).attr("id").length)];b.suggestions=new Array();var a=$(".suggestion input[name=suggestions]").filter(":checked");if(a.length==0){showMessage(gettext("No hay ninguna sugerencia seleccionada"),"error")}else{a.each(function(d,e){b.suggestions[d]=$(e).attr("id").substring(9,$(this).attr("id").length)});$.ajax({type:"POST",url:url.modify_suggestion_list,data:b,dataType:"json",success:function(d){updateSuggestions(d);updateCounter(d.id,d.keys.length);showMessage(gettext("Las sugerencias han sido añadidas a la lista"),"success")}})}}function toogleSuggestion(c){var a=$(c).parent().attr("id").substr(11);var b=$(c).parent();b.parent().find("div.expanded").toggle();b.parent().find("div.collapsed").toggle()}function setExpandible(a){$(a+" .maximize-minimize").toggle(function(){var b=$(this).parentsUntil(".tab-content");var d=b[b.length-1];var c;if($(d).attr("id")=="suggestion-list-lists"){c=$(d).children()}else{c=$(d).parent().children()}$(c).each(function(e,f){if($(f).find(".expanded").css("display")!="none"){$(f).find(".maximize-minimize").click()}});$(this).parent().find("div.expanded").slideDown("fast");$(this).parent().find(".suggestionName").toggle();$(this).parent().find(".suggestionName_editable").toggle();$(this).removeClass("suggestionCollapsed");$(this).addClass("suggestionExpanded")},function(){$(this).parent().find("div.expanded").slideUp("fast");$(this).parent().find(".suggestionName").toggle();$(this).parent().find(".suggestionName_editable").toggle();$(this).removeClass("suggestionExpanded");$(this).addClass("suggestionCollapsed")});$(a+" .suggestionName").click(function(){var b=$(this).parentsUntil(".suggestion").parent().find(".maximize-minimize");if($(b).hasClass("suggestionCollapsed")){$(b).click()}});$(a+" .suggestionName_editable").click(function(){var b=$(this).parentsUntil(".suggestion,.suggestionList").parent().find(".maximize-minimize");if($(b).hasClass("suggestionCollapsed")){$(b).click()}})}function removeSuggestions(){temp=$("input[name='suggestions']:checked");$.each(temp,function(a,b){$.ajax({type:"POST",url:"/ajax/delete/suggestion/",data:{eventid:b.value},complete:function(c){if(c.status!=200){showMessage("Error: "+c.status,"error")}else{$("#suggestion_"+b.value).fadeOut("slow").remove();showMessage("Las sugerencias han sido eliminadas con éxito","success");$("#suggestions-tab-counter").text(parseInt($("#suggestions-tab-counter").text())-1)}}})})}function removeLists(){temp=$("input[name='lists']:checked");$.each(temp,function(a,b){$.ajax({type:"POST",url:"/ajax/delete/suggestion/list/",data:{list_id:b.value},complete:function(c){if(c.status!=200){showMessage("Error: "+c.status,"error")}else{$("#list_"+b.value).fadeOut("slow").remove();showMessage(gettext("Las listas han sido eliminadas con éxito"),"success");$("#lists-tab-counter").text(parseInt($("#lists-tab-counter").text())-1);$("#dropdown-list #listid-"+b.value).remove();$(".list_"+b.value).remove()}}})})}function updateCounter(a,b){counterClass=".list-"+a+"-counter";$(counterClass).text(b)}function get_suggestion_id(d){var c={};var a=$(d).parentsUntil(":regex(id,(suggestion-list|suggestion-list-lists))");var e=a[a.length-1];if($(e).hasClass("suggestionList")){c.list_id=($(e).attr("id")).substring(5,($(e).attr("id")).length)}else{c.eventid=($(e).attr("id")).substring(11,($(e).attr("id")).length)}var b=$('form.editable-fields input[name="name"]').val();if(typeof(b)!="undefined"){c.name=b}else{c.name=$(e).find(".suggestionName").html()}if($(e).find(".editable_visibility select").length>0){c.visibility=$(e).find(".editable_visibility select").val()}else{c.visibility=$(e).find(".editable_visibility").attr("value")}return c}function nl2br(c,b){var a=(b||typeof b==="undefined")?"<br />":"<br>";return(c+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+a+"$2")}function set_editable_fields(b){var d;var c;var a={cancel:gettext("Cancelar"),data:function(h,g){var f=h.replace("\n","").replace(/<br[\s\/]?>/gi,"\n");return f},submit:gettext("Guardar"),indicator:gettext("Guardando..."),tooltip:gettext("Haz clic para editar..."),cssclass:"editable-fields",onblur:"ignore",callback:function(g,f){$(this).html(nl2br(c));if($(this).hasClass("suggestionName_editable")){this.previousElementSibling.innerHTML=nl2br(c)}},onerror:function(g,f,h){showMessage(gettext("Ouch! Se ha producido un error; perdón!, lo solucionaremos lo antes posible!"),"error")}};var e=tags_field=name_field=visibility_field=a;name_field.name="name";name_field.type="text";name_field.width="490";name_field.onsubmit=function(g,f){g.submitdata=get_suggestion_id(this);c=$(this).find("input").val();asd=this};$(".editable_list_name").editable("/ajax/suggestion/list/modify/",name_field);e.name="description";e.type="textarea";e.height="40";e.width="390";e.placeholder=gettext("Sin descripción");e.onsubmit=function(g,f){g.submitdata=get_suggestion_id(this);c=$(this).find("textarea").val()};$(".editable_description").editable("/ajax/add/suggestion/",e);e.placeholder=gettext("Esta lista aún no tiene descripción");$(".editable_list_description").editable("/ajax/suggestion/list/modify/",e);tags_field.name="tags";tags_field.type="text";tags_field.height="20";tags_field.width="none";tags_field.placeholder=gettext("Esta sugerencia no tiene tags");tags_field.onsubmit=function(g,f){g.submitdata=get_suggestion_id(this);c=$(this).find("input").val()};$(".editable_tags").editable("/ajax/add/suggestion/",tags_field);tags_field.placeholder=gettext("Esta lista de sugerencias no tiene tags");$(".editable_list_tags").editable("/ajax/suggestion/list/modify/",tags_field);visibility_field.name="visibility";visibility_field.type="select";visibility_field.data="{'public':'"+gettext("Pública")+"','private':'"+gettext("Privada")+"'}";visibility_field.onsubmit=function(h,g){h.submitdata=get_suggestion_id(this);var f=$(this).find("select").val();if(f=="private"){c=gettext("Privada")}else{c=gettext("Pública")}};$(".editable_visibility").editable("/ajax/add/suggestion/",visibility_field);$(".editable_list_visibility").editable("/ajax/suggestion/list/modify/",visibility_field)};